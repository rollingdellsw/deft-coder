[
  {
    "id": "session-auto-title",
    "description": "Prompt LLM to generate session title when missing",
    "trigger": {
      "type": "context",
      "condition": {
        "type": "session_needs_title"
      }
    },
    "content": "This conversation doesn't have a title yet. Try generate a meaningful title if you have enough context, include it in your response using: <set_title>Your Title Here</set_title>.",
    "strategy": "persistent",
    "priority": "low"
  },
  {
    "id": "low-context-warning",
    "description": "Warn when context window is running low",
    "trigger": {
      "type": "context",
      "condition": {
        "type": "low_context_window",
        "threshold": 10000
      }
    },
    "content": "CONTEXT WINDOW LOW: You are approaching the context limit!",
    "strategy": "sticky",
    "priority": "high"
  },
  {
    "id": "git-history-context",
    "description": "Remind to use git blame/log when user asks about code understanding",
    "trigger": {
      "type": "user_message",
      "pattern": "Selected code from"
    },
    "content": "When investigating code for the user, consider using git history for deeper context:\n1. `git blame <file> -L <start>,<end>` - Shows who last modified each line and when\n2. `git log -p <file> -L <start>:<end>` - Shows the evolution of a specific code range\n3. `git log --oneline -n 10 -- <file>` - Recent commits touching this file\n\nThis helps understand WHY code was written a certain way, not just WHAT it does. Commit messages often contain valuable context that isn't in the code itself.",
    "strategy": "one_shot",
    "priority": "medium"
  },
  {
    "id": "global-concise",
    "description": "Be concise - code over explanations",
    "trigger": {
      "type": "always"
    },
    "content": "Be concise. Show code, not explanations unless asked.",
    "strategy": "persistent",
    "priority": "low"
  },
  {
    "id": "lang-typescript",
    "description": "TypeScript strict lint rules",
    "trigger": {
      "type": "file_pattern",
      "pattern": "\\.(ts|tsx)$"
    },
    "content": "TypeScript MUST pass strict ESLint:\n- @typescript-eslint/no-explicit-any: error\n- @typescript-eslint/ban-ts-comment: error\n- @typescript-eslint/no-non-null-assertion: error\n- @typescript-eslint/strict-boolean-expressions: error\n- @typescript-eslint/no-unsafe-assignment: error\n- @typescript-eslint/no-unsafe-member-access: error\n- @typescript-eslint/no-unsafe-call: error\n- @typescript-eslint/no-unsafe-return: error\n- eqeqeq: error (use === not ==)\n- prefer-nullish-coalescing, prefer-optional-chain",
    "strategy": "sticky",
    "priority": "high"
  },
  {
    "id": "lang-javascript",
    "description": "JavaScript best practices",
    "trigger": {
      "type": "file_pattern",
      "pattern": "\\.(js|mjs|cjs)$"
    },
    "content": "JavaScript: const by default, async/await over callbacks, optional chaining (?.), nullish coalescing (??), no var, use === not ==.",
    "strategy": "sticky",
    "priority": "high"
  },
  {
    "id": "lang-python",
    "description": "Python strict type safety",
    "trigger": {
      "type": "file_pattern",
      "pattern": "\\.py$"
    },
    "content": "Python MUST pass:\n- mypy --strict --no-implicit-optional --warn-return-any --warn-unreachable\n- pylint, ruff check --select=ALL\nFORBIDDEN: Any type, # type: ignore without explanation, bare except:, eval(), exec()",
    "strategy": "sticky",
    "priority": "high"
  },
  {
    "id": "lang-cpp",
    "description": "C++ multi-standard compliance",
    "trigger": {
      "type": "file_pattern",
      "pattern": "\\.(cpp|cc|cxx|hpp)$"
    },
    "content": "C++ MUST pass:\n- clang-tidy: modernize-*, readability-*, performance-*, bugprone-*\n- cpplint (Google style)\n- cppcheck --enable=all\nFORBIDDEN: Raw pointers for ownership, manual memory management, C-style casts, goto, global mutable state. Use smart pointers (unique_ptr, shared_ptr). No exceptions, -fno-exceptions",
    "strategy": "sticky",
    "priority": "high"
  },
  {
    "id": "lang-c",
    "description": "C strict safety rules",
    "trigger": {
      "type": "file_pattern",
      "pattern": "\\.(c|h)$"
    },
    "content": "C MUST pass clang-static-analyzer, cppcheck --enable=all.\nFORBIDDEN: gets(), strcpy(), sprintf() - use safe alternatives. Check all malloc returns for NULL.",
    "strategy": "sticky",
    "priority": "high"
  },
  {
    "id": "lang-rust",
    "description": "Rust best practices",
    "trigger": {
      "type": "file_pattern",
      "pattern": "\\.rs$"
    },
    "content": "Rust MUST pass: cargo clippy -- -D warnings\n- Follow API Guidelines (rust-lang.github.io/api-guidelines)\n- Proper Result<T, E> error propagation with ? operator\n- Pay attention to async cancellation safety\n- Prefer impl Trait over Box<dyn Trait> when possible",
    "strategy": "sticky",
    "priority": "high"
  },
  {
    "id": "lang-go",
    "description": "Go strict lint rules",
    "trigger": {
      "type": "file_pattern",
      "pattern": "\\.go$"
    },
    "content": "Go MUST pass: go vet, golangci-lint, gosec, govulncheck.\nFORBIDDEN: panic() in library code, interface{} without type assertions, ignoring errors (_ = err), data races.",
    "strategy": "sticky",
    "priority": "high"
  },
  {
    "id": "lang-java",
    "description": "Java best practices",
    "trigger": {
      "type": "file_pattern",
      "pattern": "\\.java$"
    },
    "content": "Java: Optional over null, immutable objects, try-with-resources, records for data classes.",
    "strategy": "sticky",
    "priority": "high"
  },
  {
    "id": "lang-shell",
    "description": "Shell script safety",
    "trigger": {
      "type": "file_pattern",
      "pattern": "\\.(sh|bash)$"
    },
    "content": "Shell MUST pass shellcheck. Start with 'set -euo pipefail'. Quote ALL variables \"$var\". Use [[ ]] not [ ].\nFORBIDDEN: eval, unquoted variables.",
    "strategy": "sticky",
    "priority": "high"
  },
  {
    "id": "lang-sql",
    "description": "SQL security rules",
    "trigger": {
      "type": "file_pattern",
      "pattern": "\\.sql$"
    },
    "content": "SQL: Parameterized queries ONLY (never string concat). Add indexes for WHERE/JOIN. Use transactions. Explicit JOINs.",
    "strategy": "sticky",
    "priority": "high"
  },
  {
    "id": "lang-dockerfile",
    "description": "Dockerfile best practices",
    "trigger": {
      "type": "file_pattern",
      "pattern": "(Dockerfile|Containerfile)"
    },
    "content": "Dockerfile: Specific base tags (never :latest), combine RUN commands, multi-stage builds, non-root USER.",
    "strategy": "sticky",
    "priority": "high"
  },
  {
    "id": "run-test-after-write",
    "description": "Run tests after writing test files",
    "trigger": {
      "type": "tool_result",
      "toolName": "write_file",
      "outputPattern": "\\.(test|spec)\\."
    },
    "content": "Test file written. Run tests to verify.",
    "strategy": "one_shot",
    "priority": "medium"
  },
  {
    "id": "max-iteration-limit",
    "description": "Remind about long sessions",
    "trigger": {
      "type": "iteration",
      "every": 15
    },
    "content": "CRITICAL SYSTEM ALERT: You have reached 15 consecutive tool calls, try a different strategy, or ask user.",
    "strategy": "one_shot",
    "priority": "high"
  },
  {
    "id": "loop-detection-warning",
    "description": "Warn when tool loop is detected",
    "trigger": {
      "type": "context",
      "condition": {
        "type": "loop_detected"
      }
    },
    "content": "Loop detected. STOP. Explain the problem and ask for guidance.",
    "strategy": "one_shot",
    "priority": "high"
  },
  {
    "id": "patch-repeated-failures",
    "description": "Force switch to write_file after patch failures",
    "trigger": {
      "type": "context",
      "condition": {
        "type": "repeated_failures",
        "toolName": "patch",
        "count": 2
      }
    },
    "content": "STOP using patch. Read the target file with read_file, then use write_file to replace the entire file content. Do NOT attempt patch again. If you are trying revert to changes, call git_command directly",
    "strategy": "one_shot",
    "priority": "high"
  },
  {
    "id": "patch-partial-success",
    "description": "Guide agent when patch partially succeeds",
    "trigger": {
      "type": "tool_result",
      "toolName": "patch",
      "outputPattern": "hunks could not be applied|PARTIAL SUCCESS"
    },
    "content": "PATCH PARTIALLY APPLIED. Try to get the actual context from the error message with 'EXPECTED (from patch)' and 'ACTUAL' to understand the mismatch, if you can't figour out the reason purely from the error message, try to read the file again, revise your patch, give a more generous context for better macth",
    "strategy": "one_shot",
    "priority": "high"
  },
  {
    "id": "patch-no-hunks-applied",
    "description": "Guidance when patch completely fails to apply",
    "trigger": {
      "type": "tool_result",
      "toolName": "patch",
      "outputPattern": "No changes could be applied|No hunks could be applied"
    },
    "content": "PATCH FAILED. Do NOT retry patch.\n1. Read target file once (full content)\n2. Use write_file to make changes directly\n3. If you are trying to revert changes, call git_command directly",
    "strategy": "one_shot",
    "priority": "high"
  },
  {
    "id": "read-file-repeated-failures",
    "description": "Help when read_file keeps failing",
    "trigger": {
      "type": "context",
      "condition": {
        "type": "repeated_failures",
        "toolName": "read_file",
        "count": 2
      }
    },
    "content": "Multiple read_file failures. Verify path with list_files, check for typos.",
    "strategy": "one_shot",
    "priority": "high"
  },
  {
    "id": "tool-output-truncated",
    "description": "Guidance when any tool output is truncated",
    "trigger": {
      "type": "tool_result",
      "toolName": ".*",
      "outputPattern": "Output truncated"
    },
    "content": "Tool output was truncated due to size limits. For read_file, use 'start_line' and 'line_count' to paginate. For other tools, try more specific queries or filters.",
    "strategy": "one_shot",
    "priority": "high"
  },
  {
    "id": "build-failure-lsp-hint",
    "description": "Suggest LSP diagnostics after build/compile failures",
    "trigger": {
      "type": "tool_result",
      "toolName": "run_cmd",
      "success": false
    },
    "content": "Build/compile command failed. Use get_lsp_diagnostics to get exact error locations with line numbers:\n- get_lsp_diagnostics(file_path=\"src/path/to/file.ts\", severity_filter=\"error\")\nThis shows LSP errors which are often more precise than build output.",
    "strategy": "one_shot",
    "priority": "high"
  },
  {
    "id": "approaching-max-iterations",
    "description": "Warn when getting close to the max iteration limit (prevent abrupt stops)",
    "trigger": {
      "type": "iteration",
      "remainingBelow": 3
    },
    "content": "CRITICAL WARNING: You have less than 3 turns remaining before the hard iteration limit is reached. \n\n1. STOP exploring new paths.\n2. Verify what you have found so far.\n3. Formulate your final answer immediately based on current findings.\n4. Do NOT make further tool calls unless absolutely necessary to output the final result.",
    "strategy": "sticky",
    "priority": "high"
  }
]
